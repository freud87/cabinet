<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="UTF-8" />
	<title>Accueil</title>
	<link rel="stylesheet" href="index.css" />
</head>
	<body>
		<header>
			<img src="logomini.png" alt="Logo cabinet" class="logo">
			<navbar>
				<h2>Mon Cabinet</h2>
				<button><a href="patients.html" class="btn">Liste des patients</a></button>
				<button><a href="RDV.html" class="btn">Rendez-vous</a></button>
			</navbar>
			<div class="horodateur">
			  <p><span id="date"></span></br>
			  <span id="heure"></span></p>
			</div>
		</header>
		<main>
			<sidebar>
				<button onclick="">Nouveau patient</button>
				<button onclick="">Recette</button>
			</sidebar>
			<div class="rdvdujour">
				<h3>RDV du jour</h3>
				<div class="listerdv">
				</div>
			</div>
			<div class="choix">
				<input id="id" name="id">
				<button onclick="" class="btn" id="attente">Vers Salle</br>d'attente</button>
				<button onclick="" class="btn" id="chngrdv">Changer</br>RDV</button>
				<button class="btn" id="supprimer" onclick="supprimerRDV()">Supprimer</button>
			</div>
			<div class="attente">
				<h3>Salle d'attente</h3>
				<div class="confirmé">
				</div>
			</div>
			<div class="soin">
				<h3>Salle de soin</h3>
				<div class="confirmé">
				</div>
			</div>
		</main>
		<script>
			function updateHorodateur() {
			  const maintenant = new Date();

			  const optionsDate = { day: '2-digit', month: '2-digit', year: 'numeric' };
			  const dateStr = maintenant.toLocaleDateString('fr-FR', optionsDate);

			  const heures = maintenant.getHours().toString().padStart(2, '0');
			  const minutes = maintenant.getMinutes().toString().padStart(2, '0');
			  const heureStr = `${heures}:${minutes}`;

			  document.getElementById('date').textContent = dateStr;
			  document.getElementById('heure').textContent = heureStr;
			}
			// Mise à jour immédiate + chaque minute
			updateHorodateur();
			setInterval(updateHorodateur, 60 * 1000);
			
			document.addEventListener("DOMContentLoaded", () => {
			  const url = "https://script.google.com/macros/s/AKfycbxQ3tz6GH7DK0-fytd947B0PNcyzgfOgn_M7e37piaCifj7HSA40E5oSjwa8MmE7DDd/exec?action=rdv"; // remplace ici

			  fetch(url)
				.then(response => response.json())
				.then(patients => {
				  const listeRDV = document.querySelector(".listerdv");
				  listeRDV.innerHTML = "";

				  if (patients.length === 0) {
					listeRDV.innerHTML = "<p>Aucun rendez-vous aujourd’hui.</p>";
					return;
				  }

				const ul = document.createElement("ul");
				patients.forEach(p => {
				  const li = document.createElement("li");
				  li.textContent = `${p.id} - ${p.nom}`;

				  // Ajoute un événement pour afficher la div .choix au clic
				  li.addEventListener("click", () => {
					  const fullText = li.textContent.trim();
					  const idMatch = fullText.match(/^([A-Z0-9]+)/);
					  const uniqueId = idMatch[0]; // Identifiant unique extrait
					document.getElementById("id").value = uniqueId;
				
					document.querySelector(".choix").style.display = "flex";
					//choixDiv.style.display = "flex";

					
				  });

				  ul.appendChild(li);
				});
				listeRDV.appendChild(ul);
				})
				
				.catch(err => {
				  console.error("Erreur lors de l'importation des RDV :", err);
				  document.querySelector(".listerdv").innerHTML = "<p>Erreur de chargement.</p>";
				});
			});
			
			function supprimerRDV() {
  const id = document.getElementById("id").value;

  fetch("https://script.google.com/macros/s/AKfycbxQ3tz6GH7DK0-fytd947B0PNcyzgfOgn_M7e37piaCifj7HSA40E5oSjwa8MmE7DDd/exec", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      action: "supprimer",
      id: id
    })
  })
    .then(response => response.text())
    .then(data => alert(data))
    .catch(error => alert("Erreur : " + error));
}


			


		</script>
	</body>
</html>
